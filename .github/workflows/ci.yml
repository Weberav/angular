name: CI pipline Angular Build

on: push

jobs:
  Build_Test_Build_docker_image:
      runs-on: ubuntu-latest
      permissions:
        contents: read
        packages: write

      steps:

        - uses: actions/checkout@v2
        - name: Use Node.js 14.x
          uses: actions/setup-node@v1
          with:
            node-version: 14.x

        - name: Setup
          run: npm ci
          
        - name: Test
          run: npm test -- --watch=false --browsers=ChromeHeadless

        - name: Ng build
          run: npm run build

        - name: Check repo
          uses: actions/checkout@v3

        - name: Login to container registry
          uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
          with: 
            registry: ghcr.io
            username: ${{ github.actor }}
            password: ${{ secrets.TOKEN }}

        

        - name: Build and push Docker image
          uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
          with:
            context: .
            push: true
            tags: latest
            labels: weberav

        

        - uses: actions/checkout@v3
        - name: Docker image build
          run: docker build . --file Dockerfile --tag test-task

        

